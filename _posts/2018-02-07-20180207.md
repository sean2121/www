---
layout: math
title:  "緊急地震速報の受信端末を作る（２）"
date:   2018-02-07 20:03:52 +0900
permalink: /tech/:title
---

# 緊急地震速報の理論
まずは緊急地震速報の理論側をみていきたいと思います。  

緊急地震速報は現在基本的に経験則に基づいたモデルを利用しています。震源地からの距離に比例して地震の揺れが弱くなることは一般的な想像できると思いますが、過去の地震データを最大振幅等を目的変数, マグニチュード・震源距離、地盤条件などを説明変数として回帰分析して得られたものが距離減衰式です。

ということで、まずは震源距離を求める必要があります。
### 震源距離
平面の2点間距離、つまり平面座標のA,Bを  
  
$$ A(x₁，y₁)、B(x₂，y₂) $$  
  
とすると  
  
$$ AB = \sqrt{(x₂ - x₁)^2 + (y₂ - y₁)^2} $$  
  
となります。が厳密には地球は球面なので球面上の2点間距離を使う方が良いかもしれません。考え方や式の導き方まではここで説明しませんので、球面三角法などでググってください。 P（緯度φ1，経度λ1），Q（緯度φ2，経度λ2）の2つの地点を考えるとPQ間の距離は以下の式で求めることができます。$$r = 6378$$で、これは地球の半径(Km)です。
  
$$ L = r \cdot arccos(sinφ1 sinφ2 + cosφ1 cosφ2 cos(λ1 − λ2)) $$

ここでCでコードを書いて試して見ると東京タワーから札幌時計台までの距離を求めると835.700989キロメートルだそうです。



```c
    #include<stdio.h>
    #include<math.h>

    float distance(double, double, double, double);

    int main(void) 
    {
        //点P
        double latitude_s =  35.658581;   
        double longitude_s = 139.745433;
        //点Q
        double latitude_e = 43.062562;
        double longitude_e = 141.353650;

        double p2q = distance(latitude_s , longitude_s, latitude_e, longitude_e);
        printf("%f\n", p2q);
        return 0;
    }

    float distance(double latitude_s, double longitude_s, double latitude_e, double longitude_e)
    {
        double sin_lat_1 = sin(latitude_e * M_PI / 180);
        double cos_lat_1 = cos(latitude_e * M_PI / 180);
        double sin_lat_2 = sin(latitude_s * M_PI / 180);
        double cos_lat_2 = cos(latitude_s * M_PI / 180);
        double lamda1 = longitude_e * M_PI / 180;
        double lamda2 = longitude_s * M_PI / 180;
        double two_points_distance = 6370 * acos(sin_lat_1 * sin_lat_2 + cos_lat_1 * cos_lat_2 * 
        cos(lamda1 - lamda2));
        return two_points_distance;
    }

```












