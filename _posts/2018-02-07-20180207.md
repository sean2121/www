---
layout:  post
title:  "緊急地震速報の受信端末を作る（２）"
date:   2018-02-07 20:03:52 +0900
permalink: /tech/:title:output_ext
---
まずは緊急地震速報の理論側をみていきたいと思います。  
  
緊急地震速報は現在基本的に経験則に基づいたモデルを利用しています。震源地からの距離に比例して地震の揺れが弱くなることは一般的な想像できると思いますが、過去の地震データを参考に、最大振幅等を目的変数、マグニチュード・震源距離、地盤条件などを説明変数として回帰分析して得られたものが距離減衰式です。
  
ということで、まずは震源距離を求める必要があります。

### 震源距離
ここで地球を球面とし、地球上の2点間距離、PQを以下で表すと 
  
$$ P（緯度Ax，経度Ay），Q（緯度Bx，経度By） $$  
  
PQ間の距離は以下の式で求めることができます。  
$$r = 6378$$で、これは地球の半径(Km)です。  

$$ L = r \cdot arccos(sinAx sinBx + cosAx cosBx cos(Ay − By)) $$
  
しかしながら、今回のような利用場面では直線での近似値を利用しても特に問題ないと思います。  
説明の簡易性もあることから平面を採用するとして、その場合はピタゴラスの定理より
  
$$R^2=D^2+(k*(Ax-Bx))^2+(k*(Ay-By))^2$$  
  
R:震源距離(km)  
k = 111.32km (経度1度)  
Ax、Ay:活用地点の緯度・経度(単位:度)   
Bx、By:震源の緯度・経度(単位:度)  
D:震源の深さ(km)  

本来であればスクリプト言語で書く分野ではないと思いますが、今回はラピットプロトタイプングなのでRubyを使っていきましょう。


<script src="https://gist.github.com/sean2121/6f0a671776c23ec2ba3c48f3c1c2c2d0.js"></script>
  
### マグニチュード
地震の規模を示す値のマグニチュードには様々な種類があるのですが、その始まりの定義は震央距離⊿＝100kmの位置に置かれた地震計で記録された最大記録振幅Ａ（単位：μ）の常用対数を取ったものです。
この振幅を基準にした地震の規模を表す指標は、規模が大きな地震になると低周波域に波がシフトするためにMの数値に正確に反映されないという問題点がありました。
  
そこで、地震の断層運動のモーメントを表したモーメントマグニチュードが現在一般的に使われています。  
日本国内では速報性にすぐれた気象庁独自の値である、気象庁マグニチュードも発表されます。    
緊急地震速報ではこの気象庁マグニチュード(Mj)をモーメントマグニチュード(Mw)に変換して利用します。
   
宇津の経験式式(宇津：1982）より。
  
$$ Mw = Mjma - 0.171  $$ 

### 最短距離
震源地から観測値までの最短距離を求めましょう。  
地震は断層破壊によって起こるものであることから点で考えるよりも震源地は面で考える方が実態を反映します。  
宇津（1977）相似即によってMwから以下の式によって断層距離を求めます。  
  
$$ log(L)=0.5M-1.85 $$ 


### 最大速度




















